{"name":"DynamoDB.SQL","tagline":"SQL-like external DSL for querying and scanning Amazon DynamoDB","body":"# DynamoDb.SQL ([@DynamoDbSQL](https://twitter.com/DynamoDbSQL))\r\n\r\nThis library gives you the capability to execute [**query**](http://docs.amazonwebservices.com/amazondynamodb/latest/developerguide/API_Query.html) and [**scan**](http://docs.amazonwebservices.com/amazondynamodb/latest/developerguide/API_Scan.html) operations against [**Amazon DynamoDB**](http://aws.amazon.com/dynamodb/) using a **SQL**-like syntax by extending the existing functionalities of `AmazonDynamoDBClient` and `DynamoDBContext` classes found in the standard .Net AWS SDK.\r\n\r\nThis guide contains the following sections:\r\n- [Basics](#basics) - how to get started using this library\r\n- [Features](#features) - what you can do with this library\r\n- [Examples](#examples) - links to examples in F# and C#\r\n\r\nYou can view the release notes [here](https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/RELEASE_NOTES.md), and check out the [Wiki](https://github.com/theburningmonk/DynamoDb.SQL/wiki).\r\n\r\n\r\n\r\n\r\n\r\n## Basics\r\n\r\n#### Getting Started\r\n\r\nDownload and install **DynamoDb.SQL** using [NuGet](https://nuget.org/packages/DynamoDb.SQL).\r\n\r\n<a href=\"https://nuget.org/packages/DynamoDb.SQL\"><img src=\"http://theburningmonk.com/images/dynamodb.sql-nuget-install.png\" alt=\"NuGet package\"/></a>\r\n\r\n\r\n\r\nNow suppose we have a DynamoDB tabled called `GameScores` like the following:\r\n\r\n![!table](http://dynamodb.sql.s3.amazonaws.com/dynamodb-sql-table.png)\r\n\r\nTo find all the scores for the player with `UserId` \"theburningmonk-1\" we can simply execute the query like the following:\r\n\r\n```fsharp\r\n\r\nopen Amazon.DynamoDBv2\r\nopen Amazon.DynamoDBv2.DataModel\r\n\r\nlet awsKey      = \"MY-AWS-KEY\"\r\nlet awsSecret   = \"MY-AWS-SECRET\"\r\nlet region      = RegionEndpoint.USEast1\r\n\r\nlet client = new AmazonDynamoDBClient(awsKey, awsSecret, region)\r\nlet ctx    = new DynamoDBContext(client)\r\n\r\nlet query  = \"SELECT * FROM GameScores WHERE UserId = \\\"theburningmonk-1\\\"\"\r\nlet scores = ctx.ExecQuery<GameScore>(selectQuery)\r\n```\r\n\r\nwhilst the above example is in F#, the same extension methods are accessible from C# too, check out the full range of examples in the [Examples](#examples) section.\r\n\r\nFor a **detailed run-down of the syntax** please refer to this [**page**](https://github.com/theburningmonk/DynamoDb.SQL/wiki/Getting-Started-V2#syntax).\r\n\r\n\r\n## Features\r\n\r\n\r\n#### Simple SQL-like syntax\r\n\r\nThis library lets you use a SQL-like syntax for performing *query* and *scan* operations against *DynamoDB*. If you're new to *DynamoDB* and is not clear on the difference between the two, please refer to the *DynamoDB* documentation [here](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/QueryAndScan.html) and guidelines [here](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/QueryAndScanGuidelines.html).\r\n\r\nUsing the appropriate extension methods on `AmazonDynamoDBClient` and `DynamoDBContext` you will be able to query/scan your *DynamoDB* table like this:\r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT * FROM GameScores WHERE UserId = \\\"theburningmonk-1\\\"\"\r\nlet response    = client.Query(selectQuery)\r\n```\r\n\r\nWhilst the syntax for both *query* and *scan* operations are similar, there are minor differences and some comparisons (such as `CONTAINS` and `IN (...)`) are only supported in *scan* operations by *DynamoDB*.\r\n \r\nFor a **detailed run-down of the syntax** please refer to this [**page**](https://github.com/theburningmonk/DynamoDb.SQL/wiki/Getting-Started-V2#syntax).\r\n\r\n#### Count-only queries\r\n\r\nIf you only want to find out the number of items that matches some conditions and not the items themselves, then you can save yourself some bandwidth and read capacity units by using a **COUNT** query:\r\n\r\n```fsharp\r\nlet countQuery    = \"COUNT * FROM GameScores WHERE UserId = \\\"theburningmonk-1\\\"\"\r\nlet countResponse = client.Query(countQuery)\r\n```\r\n> **Note**: count queries are **only supported** when you're working with the `AmazonDynamoDBCient`.\r\n\r\n\r\n#### Selecting specific attributes\r\n\r\nIf you only want to retrieve certain attributes from your query, then you can save yourself some bandwidth and potentially processing power by specifying exactly which attributes you want to retrieve:\r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT UserId, GameTitle, Wins FROM GameScores WHERE UserId = \\\"theburningmonk-1\\\"\"\r\nlet response    = client.Query(selectQuery)\r\n```\r\n\r\n\r\n#### Ordering and Limiting\r\n\r\nOften you will want to retrieve only the top or bottom X number of items based on the natural sorting order of the range key values. Therefore it often makes sense to combine the **ORDER** and **LIMIT** clauses in your query.\r\n\r\nFor example, in our `GameScores` table (see above), to find the top 3 scoring games for a given user we can write:\r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT * FROM GameScores WHERE UserId = \\\"theburningmonk-1\\\" ORDER DESC LIMIT 3\"\r\nlet response    = client.Query(selectQuery)\r\n```\r\n\r\n> **Note**: in *DynamoDB*, you can only order on the range key values hence why there's no option for you to specify what column to order on in the query syntax.  \r\n\r\n\r\n#### Throttling\r\n\r\nAs stated in the DynamoDB [best practices guide](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/BestPractices.html), you should [avoid sudden bursts of read activity](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/QueryAndScanGuidelines.html#QueryAndScanGuidelines.BurstsOfActivity).\r\n\r\nTo throttle your *query* or *scan* operation, you can use the **PageSize** option in your query to throttle the amount of read capacity units that your query consumes in one go:\r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT * FROM GameScores WHERE UserId = \\\"theburningmonk-1\\\" WITH (PageSize(10))\"\r\nlet response    = client.Query(selectQuery)\r\n```\r\nthis query will fetch 10 results at a time, if there are more than 10 results available then additional requests will be made behind the scene until all available results have been retrieved. \r\n\r\n> **Note**: using the *PageSize* option means your *query* or *scan* will take longer to complete and require more individual requests to *DynamoDB*.\r\n\r\n\r\n#### Parallel scans\r\n\r\nIf your table is sufficiently large (*DynamoDB* documentations suggests 20GB or larger), [it's recommended](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/QueryAndScanGuidelines.html#QueryAndScanGuidelines.ParallelScan) that you take advantage of the parallel scans support in *DynamoDB* to speed up the scan operations.\r\n\r\nTo use parallel scans, you can use the **Segments** option in your *scan* query:\r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT * FROM GameScores WHERE GameTitle = \\\"Starship X\\\" WITH (Segments(10))\"\r\nlet response    = client.Scan(selectQuery)\r\n```\r\nthis query will make ten parallel scan requests against *DynamoDB* and the operation will complete when all ten 'segments' have completed and returned all their results.\r\n\r\n> **Note**: using parallel scan will consume large amounts of read capacity units in a short burst, so you should plan ahead and up the throughput of your table accordingly before starting the parallel scan!\r\n\r\n\r\n#### Local Secondary Index support\r\n\r\n> *AWS* [announced](http://aws.typepad.com/aws/2013/04/local-secondary-indexes-for-amazon-dynamodb.html) support for *Local Secondary Indexes* on April 18, 2013, for more details please refer to the *DynamoDB* documentations page [here](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/LSI.html) and [guidelines](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GuidelinesForLSI.html) for using *Local Secondary Indexes*.\r\n\r\nSupport for local secondary index is available since version 1.2.1 using the **INDEX** option inside the **WITH** clause.\r\n\r\nFor example, suppose the aforementioned `GameScores` table has a local secondary index called **TopScoreIndex**:\r\n\r\n![table-indexes](http://dynamodb.sql.s3.amazonaws.com/dynamodb-sql-indexes.png)\r\n\r\nWe can query the table using this index and optionally specify whether to retrieve all attributes or just the attributes projected into the index (any attributes that are not on the index will be retrieved from the table using extra read capacity):\r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT * FROM GameScores \r\n                   WHERE UserId = \\\"theburningmonk-1\\\" \r\n                   AND TopScore >= 1000 \r\n                   WITH(Index(TopScoreIndex, true))\"\r\nlet response = client.Query(selectQuery)\r\n```\r\n\r\nFor more details, please read [this post](http://theburningmonk.com/2013/05/dynamodb-sql-1-2-1-now-supports-local-secondary-index/).\r\n\r\n\r\n#### Global Secondary Indexes support\r\n\r\n> *AWS* [announced](http://aws.typepad.com/aws/2013/12/now-available-global-secondary-indexes-for-amazon-dynamodb.html) support for *Global Secondary Indexes* on December 12, 2013, for more details please refer to the *DynamoDB* documentations page [here](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GSI.html) and [guidelines](http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/GuidelinesForGSI.html) for using *Global Secondary Indexes*.\r\n\r\n*Global Secondary Indexes*, or *GSI* is supported through the same **INDEX** option as local secondary index above, the index name specified in the *INDEX* option can be any local or global index on the table.\r\n\r\nFor example, to query against the global secondary index **GameTitleIndex** on our `GameScores` table (see above):  \r\n\r\n```fsharp\r\nlet selectQuery = \"SELECT * FROM GameScores \r\n                   WHERE GameTitle = \\\"Starship X\\\" \r\n                   AND TopScore >= 1000\r\n                   WITH(Index(GameTitleIndex, false), NoConsistentRead)\"\r\nlet response = client.Query(selectQuery)\r\n```\r\n\r\n> **Important**: although the queries look identical, compared to local secondary indexes there are a couple of key differences you need to be aware of when querying against global secondary indexes:\r\n> - you **must add the NoConsistentRead option** in your query as global secondary indexes only support eventually consistent reads, if you try to do a consistent read against a global secondary index it will result in an error from *DynamoDB*;\r\n> - when you created the global secondary index, if you didn't choose **All Attributes** as the **Projected Attributes** for the index, then you must set the \"all attributes\" flag in the `Index` option to `false` (i.e. Index(IndexName, **false**))\r\n\r\n## Examples\r\n\r\nHere's a handful of examples in C# and F#, feel free to check out the respective project under the **examples** folder too, it also contains F# script to create the sample table and seeding it with test data you need to run these examples. \r\n\r\n#### Query\r\n\r\n<table>\r\n\t<tbody>\r\n\t\t<tr>\r\n\t\t\t<td>Get all rows for a hash key</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L66-L79>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L78-L97>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Query with range key</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L81-L97>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L103-L128>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Query with ORDER and LIMIT</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L99-L114>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L132-L169>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Disable consistent read</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L116-L129>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L173-L185>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Throttling</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L131-L144>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L190-L203>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Selecting specific attributes</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L146-L165>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L207-L226>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Query with Local Secondary Index (all attributes)</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L178-L195>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L247-L295>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Query with Local Secondary Index (projected attributes)</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L197-L214>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L302-L337>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Query with Global Secondary Index (projected attributes)</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L216-L235>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L345-L394>F#</a></td>\r\n\t\t</tr>\r\n\t</tbody>\r\n</table>\r\n\r\n#### Scan\r\n\r\n\r\n<table>\r\n\t<tbody>\r\n\t\t<tr>\r\n\t\t\t<td>Basic scan</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L241-L254>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L424-L443>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Scan with LIMIT</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L256-L269>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L447-L466>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Throttling</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L271-L284>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L469-L484>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Selecting specific attributes</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L312-L329>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L487-L505>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Parallel scans</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L286-L299>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L508-L523>F#</a></td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>Disable returning consumed capacity</td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleCs/Program.cs#L301-L310>C#</a></td>\r\n\t\t\t<td><a href=https://github.com/theburningmonk/DynamoDb.SQL/blob/develop/examples/DynamoDb.SQL.ExampleFs/Examples.fsx#L528-L538>F#</a></td>\r\n\t\t</tr>\r\n\t</tbody>\r\n</table>","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}